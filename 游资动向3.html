<!DOCTYPE HTML>
<html>
	<head>
	<title>游资动向</title>
	<link href="css/text.css" rel="stylesheet" type="text/css" />
	<meta charset="utf-8" />
	<style>
		.fixedBox{
			border: 1px solid #555555;				
			white-space: nowrap;	
		}
		.fixedBox::-webkit-scrollbar {
			width: 12px;     
			height: 12px;				
		}
		table{
			margin-left:-10px;
			width:300px; 
			border-collapse:collapse; 
			text-align:center;
		}
		td,th{border:1px solid #696969}		
		
		#tag{
			margin:-5px 10px 5px 0px;
			border: 1px solid #FFFF88;
			padding: 3px;
			display: inline-block;
			color: #F9F9F9;
		}
		#tag1{
			margin-left:10px;
			border: 1px solid #FF0000;
			padding: 3px;
			display: inline-block;
			color: #FFFF00;
		}
		#tag2{	
			margin-left:10px;
			border: 1px solid #00FF00;
			padding: 3px;
			display: inline-block;
			color: #FFFF00;
		}
		#tag3{	
			margin-left:10px;
			border: 1px solid #FFBF80;
			padding: 3px;
			display: inline-block;
			color: #FFFFB9;
		}
		#tag4{	
			margin-left:10px;
			border: 1px solid #FF0000;
			padding: 3px;
			display: inline-block;
			color: #FF80FF;
		}		
		#tag5{	
			margin-left:10px;
			border: 1px solid #00FF00;
			padding: 3px;
			display: inline-block;
			color: #6FFFB7;
		}				
	</style>
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="DatePicker/WdatePicker.js"> </script>
	</head>
	<body>
		<div id="title"></div>
		<div id="content" class="fixedBox"></div>	
		<script>
			var bkcolor = $("body").css("backgroundColor");
			var dt = "";
			var tt = "";			
			var k = 0;
			var tdx = 1; 
			var g = 1; //龙虎榜买卖显示格式（1：对齐；0：紧凑）
			window.onload = function() {			
				if(navigator.userAgent.indexOf("TdxW") == -1){ //识别是否为通达信
					tdx = 0;
				}
				var day = new Date();				
				mymonth = day.getMonth()+1;
				myday = day.getDate();
				if(mymonth >= 10){mymonth = mymonth;}else{mymonth = "0" + mymonth;}
				if(myday >= 10){myday = myday;}else{myday = "0" + myday;}
				tt = day.getFullYear() + "-" + mymonth + "-" + myday;
				//dt = tt;			
				changeStyle();
				start();
			}
			
			function time_range(beginTime, endTime) {
				var strb = beginTime.split(":");
				if (strb.length != 2) {
					return false;
				}

				var stre = endTime.split(":");
				if (stre.length != 2) {
					return false;
				}

				var b = new Date();
				var e = new Date();
				var n = new Date();

				b.setHours(strb[0]);
				b.setMinutes(strb[1]);
				e.setHours(stre[0]);
				e.setMinutes(stre[1]);

				if (n.getTime() - b.getTime() > 0 && n.getTime() - e.getTime() < 0) {
					getHQ();					
					console.log(true)　　　　　　
					return true;				
				} else {
					console.log(false)
				    return false;     
				}
			}　　　
   　　　
			$(function() {
				setInterval(function() {					
					time_range("9:00","15:15")														
				},
				10000);
			})
			
			function changeStyle() {				
				var div = document.getElementById("title");				
				div.style.left= "0px"; 				
				div.style.width= "98%";	
				div.style.height= "20px";	
				
				var div = document.getElementById("content");				
				div.style.top= "35px"; 
				div.style.left= "10px"; 				
				div.style.width= "98%";	
				div.style.height= "90%";
				div.style.fontSize= "14px";		
			}
			
			Date.prototype.Format = function (fmt) {
				var o = {
				"M+": this.getMonth() + 1, //月份
				"d+": this.getDate(), //日
				"h+": this.getHours(), //小时
				"m+": this.getMinutes(), //分
				"s+": this.getSeconds(), //秒
				"q+": Math.floor((this.getMonth() + 3) / 3), //季度
				"S": this.getMilliseconds() //毫秒
				};
				if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
				for (var k in o)
				if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
				return fmt;
			};
			
			function getLocalTime(nS) {			          
				return new Date(parseInt(nS*1000)).Format("hh:mm:ss")
			}

			function keepTwoDecimal(num) {  
               var result = parseFloat(num);  
               if (isNaN(result)) {  
                   //alert('传递参数错误，请检查！');  
                   return false;  
               }  
               result = Math.round(num * 100) / 100;  
               return result;  
			};		
			
			function NumberTransform(num) { 
				var result = parseFloat(num);
				if (isNaN(result)) {                    
				   return false;  
				}  				
				if(Math.abs(result) > 100000000){
					result = result / 100000000;
					result = result.toFixed(2) + "亿";
				}else if(Math.abs(result) > 10000){
					result = result/10000;
					result = result.toFixed(0) + "万";
				}
				return result;  
			}
			
			var zfs = [];	
			function getzf(dms) {
				var url = "http://qt.gtimg.cn/q=" + dms;
				zfs = [];
				var aa = ""
				$.ajax({
					type: "get",
					url: url,
					dataType: "text",
					async : false,
					cache:false,
					timeout:3000,					
					success: function(data) {
						//alert(JSON.stringify(data))						
						//document.write(data);							
						var ss = data.replace(/(")|(=)/g,'').split(';');						
						for (var i = 0; i < ss.length - 1; i++){
							var aa = ss[i].split("~")
							zfs.push({"code":aa[2],"name":aa[1],"xj":aa[3],"zf":aa[32],"hsl":aa[38]});
						}
					}
				});
			}			
			
			function cDayFunc(dp){ 
				var date = dp.cal.getNewDateStr();
				BookingRmk(date);//调用其它函数并带上参数  
			}
			
			function BookingRmk(date){         
				tt = date;
				var date1 = new Date(tt);
				var date2 = new Date(dt);
				k = 0;
				if(date1.getTime() < date2.getTime()){			
					k = 1;
					tradeday();
				}else{
					tt = dt
				}
				//getSource(fs)
				setTimeout(function(){getSource(fs)}, 100);  //延时执行;						
			}
			
			function prev(){  //前一天
				pn = -1;
				var day = new Date(tt);	
				day.setTime(day.getTime() - 24*60*60*1000);	
				tt = day.Format("yyyy-MM-dd");
				BookingRmk(tt);
			}
			
			function next(){  //后一天 				
				pn = 1;
				var day = new Date(tt);	
				day.setTime(day.getTime() + 24*60*60*1000);	
				tt = day.Format("yyyy-MM-dd");
				BookingRmk(tt);			
			}
			
			var pn = -1;
			function tradeday() {  //判断最后交易日
				var day = new Date(tt);							
				for (i = 1; i < 100; i++){	//节假日																										
					if(i > 1){
						day.setTime(day.getTime() + pn*24*60*60*1000);							
					}	
					tt = day.Format("yyyy-MM-dd");
					//alert(tt);
					if(tt == dt){	
						k = 0;
						getSource(fs);
						break;
					}
					var url = "https://applhb.longhuvip.com/w1/api/index.php?c=Index&a=YouZiDongXiangByList&apiv=w34&Time=" + tt;
					var res = [];
					$.ajax({
						type: "get",
						url: url,
						dataType: "json",
						async : false,
						cache:false,
						timeout:3000,						
						success: function(data) {							
							//alert(JSON.stringify(data))		
							res = data.DongXiang;
						}
					});
					if(res != "[]"){						
						break;
					}
				}
			}				
			
			function start() {
				var div = document.getElementById('title');
				var p1 = "<a href='javascript:void(0)' id='px1' onclick='getSource(1)'>" + "游资动向" + "</a>";				
				var p2 = "<a href='javascript:void(0)' id='px2' onclick='getSource(2)'>" + "机构" + "</a>";	
				var p3 = "<a href='javascript:void(0)' id='px3' onclick='getSource(3)'>" + "股票" + "</a>";
				var p4 = "<a href='javascript:void(0)' id='px4' onclick='getSource(4)'>" + "营业部" + "</a>";	
				div.innerHTML = '<font size="4">游资动向</font><font size="2">（ ' + p1 + p2 + p3 + p4 + '）</font><input style="width:90px;" type="text" id="PriceDate" name="PriceDate" class="Wdate" onFocus="WdatePicker({ onpicking: cDayFunc})" />';						
				var back = '<a href="javascript:prev();"  style="padding-left:10px;;font-size:16px;color:#fff;">←</a>';					
				var forward = '<a href="javascript:next();"  style="padding-left:10px;font-size:16px;color:#fff;">→</a>';
				div.innerHTML += back + forward + '<br>';
				
				getSource(fs);
			}
			
			var st = "";
			var dma	= "";
			var dmb	= "";
			var yn = 0;
			var fs = 1;			
			function getSource(p) {
				fs = p;				
				var alist = document.getElementById("title").getElementsByTagName("a");					
				for(var i = 0; i < alist.length; i++){				
					alist[i].style.color = "#F9F9F9"; //给所有a标签赋原色
				}
				var aObj = document.getElementById('px' + p);				
				aObj.style.color = "#FFA07A";		
				
				var div = document.getElementById('content');
				div.innerHTML = "";				
				if(p == 1){
					var url1 = "https://applhb.longhuvip.com/w1/api/index.php?c=Index&a=YouZiDongXiangByList&apiv=w34";
					var url2 = "https://applhb.longhuvip.com/w1/api/index.php?c=Index&a=YouZiDongXiangByList&apiv=w34&Time=" + tt;
					
					var url = url1;
					if(k == 1){
						url = url2;
					}
										
					var res = [];
					$.ajax({
						type: "get",
						url: url,
						dataType: "json",
						async : false,
						cache:false,
						timeout:3000,					
						success: function(data) {
							//alert(JSON.stringify(data))						
							//document.write(JSON.stringify(data));							
							res = data.DongXiang;
							if(k == 0){	
								tt = data.Time;								
								dt = tt;
								st = getNewData(tt, -3); //推算日期（用于游资或营业部参与的股票显示当日涨幅）
							}							
						}
					});
					//document.write(JSON.stringify(res));
					
					var newDiv1 = document.createElement("div");
					newDiv1.id = "游资动向";					
					newDiv1.className = "fixedBox";
					newDiv1.style.position= "relative"; 
					newDiv1.style.float= "left";
					newDiv1.style.left= "-20px"; 
					newDiv1.style.width= "28%";		//游资动向左侧宽度
					newDiv1.style.border= "none";
					//newDiv1.style.border= "2px solid #FFFF00";
					div.appendChild(newDiv1);
					
					
					var newDiv2 = document.createElement("div");
					newDiv2.id = "yzgp";
					newDiv2.className = "fixedBox";
					newDiv2.style.position= "relative"; 
					newDiv2.style.float= "left"; 
					//newDiv2.style.top= "40px";
					newDiv2.style.left= "0px"; 
					newDiv2.style.width= "38%";	   //游资动向右侧宽度
					newDiv2.style.border= "none";
					div.appendChild(newDiv2);
					
					var newDiv3 = document.createElement("div");
					newDiv3.id = "lhb";
					newDiv3.className = "fixedBox";
					newDiv3.style.position= "relative"; 
					newDiv3.style.float= "left"; 
					//newDiv3.style.top= "40px";
					newDiv3.style.left= "0px"; 
					newDiv3.style.width= "30%";	   //龙虎榜宽度
					newDiv3.style.border= "none";
					div.appendChild(newDiv3);
					
					var dms	= "";
					if(res.length > 0){	
						yn = res.length;
						for (var i = 0; i < res.length; i++){
							var arr = [];
							var aa= res[i].List;
							for (var j = 0; j < aa.length; j++){								
								var code = aa[j].ID.toString();
								if(dms.indexOf(code) == -1){
									if(code.substr(0,1) == "4" || code.substr(0,1) == "8"){
										dms += "bj" + code + ",";
									}else if(code.substr(0,1) == "6"){
										dms += "sh" + code + ",";
									}else{
										dms += "sz" + code + ",";
									}
								}								
								arr.push({"代码":code,"名称":aa[j].Name,"涨幅":aa[j].IncreaseAmount,"净额":aa[j].Money})
							}
							function up(a,b){
								return b.净额 - a.净额											
							}
							arr.sort(up);
							
							var mc = res[i].ShortName;
							var id = res[i].ID;
							var name = "<a style='color:#FFFF88;font-size:16px' href='javascript:void(0)' id='id" + mc + "' onclick='yzgp(\"" + mc + "\"," + id + ");getHQ();'>" + mc + "</a>";
							newDiv1.innerHTML += "<p style='margin:0px 0px 5px 5px;'>" + name + "</p>";
							var newDiv = document.createElement("div");
							newDiv.id = mc;
							newDiv1.appendChild(newDiv);
							
							ids = "游资动向";
							tables(arr,mc);								
							
							if(i == 0){
								yzgp(mc,id);
							}
						}
						
						dma = dms;
						for(var i = 0; i < res.length; i++){
							var table = document.getElementsByTagName("table")[i];
							makeSortable(table,i,ids);
							hover();
						}
						
					}				
				}else if(p == 3){
					var url1 = "https://applhb.longhuvip.com/w1/api/index.php?st=500&a=GetStockList&c=LongHuBang&Index=0&apiv=w34&Type=2&Time=";
					var url2 = "https://applhb.longhuvip.com/w1/api/index.php?st=500&a=GetStockList&apiv=w34&Type=2&Index=0&c=LongHuBang&Time=" + tt;
					
					var url = url1;
					if(k == 1){
						url = url2;
					}
					
					var res = [];
					$.ajax({
						type: "get",
						url: url,
						dataType: "json",
						async : false,
						cache:false,
						timeout:3000,					
						success: function(data) {
							//alert(JSON.stringify(data))						
							//document.write(JSON.stringify(data));							
							res = data;												
						}
					});
					//document.write(JSON.stringify(res));
					
					var newDiv = document.createElement("div");
					newDiv.id = "股票";
					newDiv.className = "fixedBox";
					newDiv.style.position= "relative"; 
					newDiv.style.float= "left"; 
					newDiv.style.left= "0px"; 
					newDiv.style.width= "60%";	   //左侧宽度							
					div.appendChild(newDiv);
					
					var newDiv1 = document.createElement("div");
					newDiv1.id = "lhb";
					newDiv1.className = "fixedBox";
					newDiv1.style.position= "relative"; 
					newDiv1.style.float= "left"; 
					newDiv1.style.left= "0px"; 
					newDiv1.style.width= "38%";	   //龙虎榜宽度
					div.appendChild(newDiv1);
					
					var dms	= "";					
					var arr = [];
					if(res.list.length > 0){
						var BIcon = res.BIcon;
						var SIcon = res.SIcon;
						var TIcon = res.TIcon;
						var lb = res.lb;
						for (var i = 0; i < res.list.length; i++){
							var aa = res.list[i];
							var code = aa.ID;
							//alert(JSON.stringify(BIcon[code]))"undefined"
							var byyb = "";
							var arrb = BIcon[code];
							if(arrb != undefined){
								for (var j = 0; j < arrb.length; j++){
									//byyb += "<span id='tag1'>" + arrb[j] +"</span>";
									byyb += arrb[j] + ",";
								}
							}
							byyb = byyb.substr(0,byyb.length - 1);
							
							var syyb = "";
							var arrs = SIcon[code];
							if(arrs != undefined){
								for (var j = 0; j < arrs.length; j++){
									//syyb += "<span id='tag2'>" + arrs[j] +"</span>";
									syyb += arrs[j] + ",";
								}
							}
							syyb = syyb.substr(0,syyb.length - 1);
							
							var tyyb = "";
							var arrt = TIcon[code];
							if(arrt != undefined){
								for (var j = 0; j < arrt.length; j++){
									//tyyb += "<span id='tag3'>" + arrt[j] +"T</span>";
									tyyb += arrt[j] + ",";
								}
							}
							tyyb = tyyb.substr(0,tyyb.length - 1);
							
							var lbs = "";
							var bb = lb[code];
							if(bb != undefined){								
								//lbs += "<span style='margin-left:10px;color:#FF80FF;'>" + bb +"连板</span>";
								lbs = bb;
							}
							var name = aa.Name;
							var zf = aa.IncreaseAmount;
							var je = aa.BuyIn;												
							<!-- newDiv.innerHTML += "<p style='margin-bottom:-5px;'><a style='color:#F9F9F9;' href='http://www.treeid/code_" + code  -->
							<!-- + "' onclick='lhb(\"" + code + "\",\"" + tt + "\");changeCss1(this);'>" + name + "&nbsp;&nbsp;涨幅：" + zf + "&nbsp;&nbsp;净额："  -->
							<!-- + NumberTransform(je) + lbs + byyb + syyb + tyyb + "</a></p>"; -->
							
							if(code.substr(0,1) == "4" || code.substr(0,1) == "8"){
								dms += "bj" + code + ",";
							}else if(code.substr(0,1) == "6"){
								dms += "sh" + code + ",";
							}else{
								dms += "sz" + code + ",";
							}
							arr.push({"代码":code,"名称":name,"涨幅":zf,"净额":je,"连板":lbs,"买入游资":byyb,"卖出游资":syyb,"T游资":tyyb})
						}
						function up(a,b){
							return b.净额 - a.净额											
						}
						arr.sort(up);
						//document.write(JSON.stringify(arr));
						ids = "股票";
						tables(arr,"股票",ids);

						var table = newDiv.getElementsByTagName("table")[0];
						makeSortable(table,0,ids);
						hover();
					}
					dma = dms;
				}else if(p == 2){
					var url1 = "https://applhb.longhuvip.com/w1/api/index.php?a=GetAgencyListV2&st=500&apiv=w34&c=LongHuBang&Index=0"; 								
					var url2 = "https://applhb.longhuvip.com/w1/api/index.php?a=GetAgencyListV2&st=500&apiv=w34&c=LongHuBang&Index=0&Time=" + tt;				
					var url = url1;
					if(k == 1){
					  url = url2;
					}
					var res = [];
					$.ajax({
						type: "get",
						url: url,
						dataType: "json",
						async : false,
						cache:false,
						timeout:3000,					
						success: function(data) {
							//alert(JSON.stringify(data))						
							//document.write(JSON.stringify(data));														
							res = data.List;							
						}
					});	
					//document.write(JSON.stringify(res.List));
					var dms	= "";
					var arr = [];
					for (var i = 0; i < res.length; i++){
						var aa = res[i];
						var code = aa.ID.toString();
						if(code.substr(0,1) == "4" || code.substr(0,1) == "8"){
							dms += "bj" + code + ",";
						}else if(code.substr(0,1) == "6"){
							dms += "sh" + code + ",";
						}else{
							dms += "sz" + code + ",";
						}
						arr.push({"代码":code,"名称":aa.Name,"涨幅":aa.IncreaseAmount,"净额":aa.BuyIn,"机构数":aa.JoinNum,"流通市值":NumberTransform(aa.CircPrice),"换手率":aa.TurnoverRatio})
					}
					function up(a,b){
						return b.净额 - a.净额											
					}
					arr.sort(up);		
					var newDiv = document.createElement("div");
					newDiv.id = "机构";
					newDiv.className = "fixedBox";
					newDiv.style.position= "relative"; 
					newDiv.style.float= "left"; 
					newDiv.style.left= "0px"; 
					newDiv.style.width= "35%";	   //左侧宽度							
					div.appendChild(newDiv);
					
					var newDiv1 = document.createElement("div");
					newDiv1.id = "lhb";
					newDiv1.className = "fixedBox";
					newDiv1.style.position= "relative"; 
					newDiv1.style.float= "left"; 
					newDiv1.style.left= "0px"; 
					newDiv1.style.width= "45%";	   //龙虎榜宽度
					div.appendChild(newDiv1);
					
					ids = "机构";
					tables(arr,"机构");	
					
					var table = document.getElementsByTagName("table")[0];	
					makeSortable(table,0,ids);
					hover();
					
					dma = dms;
				}else if(p == 4){
					var url1 = "https://applhb.longhuvip.com/w1/api/index.php?a=GetBusinessList&st=60&c=LongHuBang&Index=0&apiv=w34&Type=0"; 								
					var url2 = "https://applhb.longhuvip.com/w1/api/index.php?a=GetBusinessList&st=60&c=LongHuBang&Index=0&apiv=w34&Type=0&Time=" + tt;				
					var url = url1;
					if(k == 1){
					  url = url2;
					}
					var res = [];
					$.ajax({
						type: "get",
						url: url,
						dataType: "json",
						async : false,
						cache:false,
						timeout:3000,					
						success: function(data) {
							//alert(JSON.stringify(data))						
							//document.write(JSON.stringify(data));														
							res = data.list;
										
						}
					});	
					//document.write(JSON.stringify(res));
					var arr = [];
					for (var i = 0; i < res.length; i++){
						var aa = res[i];
						var buy = aa.Buy;
						var sell = aa.Sell;
						var je = buy - sell;
						arr.push({"代码":aa.ID,"名称":aa.Name,"净额":je,"关联数":aa.JoinNum})
					}
					function up(a,b){
						return b.净额 - a.净额											
					}
					arr.sort(up);
					var newDiv = document.createElement("div");
					newDiv.id = "营业部";					
					newDiv.className = "fixedBox";
					newDiv.style.position= "relative"; 
					newDiv.style.float= "left";
					//newDiv.style.top= "40px";
					newDiv.style.left= "0px"; 
					newDiv.style.width= "32%";	//营业部左侧宽度
					div.appendChild(newDiv);
					
					var newDiv1 = document.createElement("div");
					newDiv1.id = "yybgp";
					newDiv1.className = "fixedBox";
					newDiv1.style.position= "relative"; 
					newDiv1.style.float= "left"; 
					//newDiv1.style.top= "40px";
					newDiv1.style.left= "0px"; 
					newDiv1.style.width= "32%";	 //营业部右侧宽度
					//newDiv1.style.border= "2px solid #fff";
					div.appendChild(newDiv1);
					
					var newDiv2 = document.createElement("div");
					newDiv2.id = "lhb";
					newDiv2.className = "fixedBox";
					newDiv2.style.position= "relative"; 
					newDiv2.style.float= "left"; 
					newDiv2.style.left= "0px"; 
					newDiv2.style.width= "30%";	   //龙虎榜宽度
					div.appendChild(newDiv2);
					
					ids = "营业部";
					tables(arr,"营业部",ids);

					var table = newDiv.getElementsByTagName("table")[0];							
					makeSortable(table,0,ids);
					hover();
					
					$("#营业部 a")[1].click();
				}
				getHQ();
				document.getElementById("PriceDate").value = tt;
				div.scrollTop = 0; //回到顶部	
			}
			
			var ids = "";
			function yzgp(mc,id) {
				var div = document.getElementById('yzgp');
				div.innerHTML = "<p style='color:#FFFF88;font-size:16px;'>" + mc + "</p>";
				
				var money = 500;  //万
				var url1 = "https://applhb.longhuvip.com/w1/api/index.php?apiv=w31&c=BusinessGroup&a=GroupInfo&GID=" + id;
				var res1 = [];
				$.ajax({
					type: "get",
					url: url1,
					dataType: "json",
					async : false,
					cache:false,
					timeout:3000,					
					success: function(data) {
						//alert(JSON.stringify(data))						
						//document.write(JSON.stringify(data));																				
						div.innerHTML += "<p style='margin-top:-10px;color:#F9F9F9;white-space: normal;'>" + data.Info + "</p>";
						var yyb = "";
						for (var i = 0; i < data.BusinessList.length; i++){
							var aa = data.BusinessList[i];
							yyb += "<span id='tag'>" + aa.Name + "</span>";
						}
						div.innerHTML += "<p style='white-space: normal;'>" + yyb + "</p>";
					}
				});	
				
				var url = "https://applhb.longhuvip.com/w1/api/index.php?apiv=w31&c=BusinessGroup&a=GroupLog&GID=" + id + "&st=1000&Index=0&Money=" + money * 10000 + "&Order=2&Day=3";
				var res = [];
				$.ajax({
					type: "get",
					url: url,
					dataType: "json",
					async : false,
					cache:false,
					timeout:3000,					
					success: function(data) {
						//alert(JSON.stringify(data))						
						//document.write(JSON.stringify(data));														
						res = data.list;								
					}
				});	
				
				var dms = "";				
				var arr = [];
				for (var i = 0; i < res.length; i++){
					var aa = res[i];
					var code = aa.StockID.toString();
					var rq = aa.Time;
					var buy = aa.Buy;
					var sell = aa.Sell;
					var je = buy - sell;
					var type = "买入";					
					if(aa.Type == "2"){
						type = "卖出";
					}					

					if(rq.replace(/-/g,"") >= st.replace(/-/g,"")){
						if(code.substr(0,1) == "4" || code.substr(0,1) == "8"){
							dms += "bj" + code + ",";
						}else if(code.substr(0,1) == "6"){
							dms += "sh" + code + ",";
						}else{
							dms += "sz" + code + ",";
						}
					}
					arr.push({"代码":code,"名称":aa.Name,"日期":rq,"涨幅":aa.IncreaseAmount,"净额":je,"类别":type})
				}
				
				ids = "yzgp";
				tables(arr,"yzgp");
				
				var table = div.getElementsByTagName("table")[0];
				makeSortable(table,0,ids);
				hover();
				
				dmb = dms;
				
				div.scrollTop = 0; //回到顶部
			}
			
			function yybgp(mc,id) {			
				var div = document.getElementById('yybgp');
				div.innerHTML = "<p style='color:#FFFF88;font-size:14px;'>" + mc + "</p>";
				var money = 500;  //万
				var url = "https://applhb.longhuvip.com/w1/api/index.php?apiv=w31&c=Business&BusinessID=" + id + "&Time=12&st=1000&a=GetNewDoStockLog&Index=0&Day=3&Money=" + money * 10000 + "&Order=2"; 								
				var res = [];
				$.ajax({
					type: "get",
					url: url,
					dataType: "json",
					async : false,
					cache:false,
					timeout:3000,					
					success: function(data) {
						//alert(JSON.stringify(data))						
						//document.write(JSON.stringify(data));														
						res = data.list;								
					}
				});	
				
				var dms = "";				
				var arr = [];
				for (var i = 0; i < res.length; i++){
					var aa = res[i];
					var code = aa.StockID.toString();
					var rq = aa.Time;
					var buy = aa.Buy;
					var sell = aa.Sell;
					var je = buy - sell;
					var type = "买入";
					if(aa.Type == "2"){
						type = "卖出";
					}
					
					if(rq.replace(/-/g,"") >= st.replace(/-/g,"")){
						if(code.substr(0,1) == "4" || code.substr(0,1) == "8"){
							dms += "bj" + code + ",";
						}else if(code.substr(0,1) == "6"){
							dms += "sh" + code + ",";
						}else{
							dms += "sz" + code + ",";
						}
					}
					arr.push({"代码":code,"名称":aa.Name,"日期":rq,"涨幅":aa.IncreaseAmount,"净额":je,"类别":type})
				}
				
				ids = "yybgp";
				tables(arr,"yybgp");
				
				var table = div.getElementsByTagName("table")[0];
				makeSortable(table,0,ids);
				hover();
				
				dmb = dms;
				//alert(dmb)
				div.scrollTop = 0; //回到顶部
			}
			
			function getNewData(dateTemp, days) {  
			   var dateTemp = dateTemp.split("-");  
			   var nDate = new Date(dateTemp[1] + '-' + dateTemp[2] + '-' + dateTemp[0]); //转换为MM-DD-YYYY格式    
			   var millSeconds = Math.abs(nDate) + (days * 24 * 60 * 60 * 1000);  
			   var rDate = new Date(millSeconds);  
			   var year = rDate.getFullYear();  
			   var month = rDate.getMonth() + 1;  
			   if (month < 10) month = "0" + month;  
			   var date = rDate.getDate();  
			   if (date < 10) date = "0" + date;  
			   return (year + "-" + month + "-" + date);  
			} 
			
			function lhb(code,tt) {	
				var div = document.getElementById('lhb');
				div.innerHTML = "";
				var newDiv = document.createElement("div");
				newDiv.id = "龙虎榜";											
				newDiv.style.width= "130%";
				div.appendChild(newDiv);
				
				var name = "";
				var ytdbusin = "";
				var url = "https://applhb.longhuvip.com/w1/api/index.php?apiv=w31&c=Stock&a=GetNewOneStockInfo&Type=0&Time=" + tt + "&StockID=" + code; 								
				var res = [];
				$.ajax({
					type: "get",
					url: url,
					dataType: "json",
					async : false,
					cache:false,
					timeout:3000,					
					success: function(data) {
						//alert(JSON.stringify(data))						
						//document.write(JSON.stringify(data));	
						name = data.Name;
						ytdbusin = data.ytdbusin;
						newDiv.innerHTML = "<p style='color:#FFFF88;font-size:14px;'>" + name + "<span style='margin-left:10px;'>" + tt + "</span></p>";
						newDiv.innerHTML += "<p style='margin:-10px 0px 10px 0px;color:#FFF;'>净买入：" + NumberTransform(data.BuyIn) + "<span style='margin-left:20px;'>关联营业部数：" + data.ToBusinessCount + "</span></p>";
						
						res = data.List;						
					}
				});	
				
				//document.write(JSON.stringify(res));	
				var count = 1;
				var w = 0; //营业部名称宽度
				for (var j = 0; j < res.length; j++){					
					var ly = res[j].UpReason;
					for (var i = 0; i < ly.length; i++){
						if(j == 0){
							if(i == 0){
								newDiv.innerHTML += "<p style='float:left;margin:-10px 0px 0px 0px;color:#00FFFF;width:98%;'>上榜理由：" + ly[i] + "</p>";
							}else{
								newDiv.innerHTML += "<p style='float:left;margin:0px 0px -5px 0px;color:#00FFFF;width:98%;'>上榜理由：" + ly[i] + "</p>";
							}
						}else{
							newDiv.innerHTML += "<p style='float:left;margin:20px 0px -10px 0px;color:#00FFFF;width:98%;'>上榜理由：" + ly[i] + "</p>";
						}
					}
					
					newDiv.innerHTML += "<p style='float:left;margin-bottom:-10px;color:#FF8040;font-size:16px;'>买入营业部：" + "<span style='color:#FFFF00;font-size:14px;'>买入总计" + NumberTransform(res[j].BuyTotal) + "元</span></p>";					
					var newDiv1 = document.createElement("div");
					newDiv1.id = "买入营业部";
					newDiv1.className = "fixedBox";
					newDiv1.style.position= "relative"; 
					newDiv1.style.float= "left"; 					
					newDiv1.style.left= "0px"; 
					newDiv1.style.width= "98%";
					//newDiv1.style.background= "#460023";    
					newDiv1.style.border= "2px solid #C0C0C0";
					newDiv.appendChild(newDiv1);
										
					for (var i = 0; i < res[j].BuyList.length; i++){
						var aa = res[j].BuyList[i];
						var id = aa.ID;
						var name = aa.Name;
						//alert(name)
						var px = aa.PX;
						var buy = aa.Buy;
						var sell = aa.Sell;
						var je = buy - sell;
						
						var yzp = "";
						var youZiIcon = aa.YouZiIcon;
						if(youZiIcon == 1){
							yzp = "一线游资";
						}else if(youZiIcon == 2){
							yzp = "顶级游资";					
						}else if(youZiIcon == 3){
							yzp = "知名游资";					
						}
						if(yzp != ""){
							yzp = "<span id='tag1'>" + yzp + "</span>";
						}
						
						var yzmc = "";
						var groupicon = aa.GroupIcon[0];
						if(groupicon != undefined){
							yzmc = "<span id='tag1'>" + groupicon + "</span>";
						}
						
						var gl = "";
						var associcon = aa.AssocIcon;
						if(associcon == 1){
							gl = "<span id='tag1'>关联</span>";
						}
						
						var zb = "";
						var zs = "";
						if(ytdbusin != ""){
							var ystb = ytdbusin.buy;
							if(ystb != undefined){
								var aa = ystb[id];
								if(aa != undefined){
									zb = "<span id='tag4'>昨买" + aa + "</span>";
								}
							}
							
							var ysts = ytdbusin.sell;
							if(ysts != undefined){
								var aa = ysts[id];
								if(aa != undefined){
									zs = "<span id='tag5'>昨卖" + aa + "</span>";
								}
							}
						}
												
						//买卖显示格式
						if(g == 0){
							newDiv1.innerHTML += "<p>" + px + "、" + name + "<span style='margin-left:10px;color:#FF80FF;'>买：" + 
							NumberTransform(buy) + "</span><span style='margin-left:5px;color:#00FF80;'>卖：" + NumberTransform(sell) + 
							"</span><span style='margin-left:5px;color:#fff;'>净额："+ NumberTransform(je) + "</span></p>";
						}else if(g == 1){
							newDiv1.innerHTML += "<p><span id=" + count + "a>" + px + "、" + name + "</span><span id=" + count + "b style='color:#FF80FF;'>买：" + 
							NumberTransform(buy) + "</span><span id=" + count + "c style='color:#00FF80;'>卖：" + NumberTransform(sell) + 
							"</span><span id=" + count + "d style='color:#fff;'>净额："+ NumberTransform(je) + "</span></p>";
							
							//计算字符长度
							var diva = document.getElementById(count + 'a');
							var dw = diva.offsetWidth;
							if(dw > w){
								w = dw;
							}
						}
						
						if(gl + yzp + yzmc + zb + zs != ""){
							newDiv1.innerHTML += "<p style='margin:-15px 0px 0px 15px;'>" + gl + yzp + yzmc + zb + zs + "</p>";
						}
						count++;
					}
					
					newDiv.innerHTML += "<p style='float:left;margin-bottom:-10px;color:#00FF80;font-size:16px;'>卖出营业部：" + "<span style='color:#FFFF00;font-size:14px;'>卖出总计" + NumberTransform(res[j].SellTotal) + "元</span></p>";			
					var newDiv2 = document.createElement("div");
					newDiv2.id = "卖出营业部";
					newDiv2.className = "fixedBox";
					newDiv2.style.position= "relative"; 
					newDiv2.style.float= "left"; 					
					newDiv2.style.left= "0px"; 
					newDiv2.style.width= "98%";
					//newDiv2.style.background= "#002800";
					newDiv2.style.border= "2px solid #C0C0C0";
					newDiv.appendChild(newDiv2);
					for (var i = 0; i < res[j].SellList.length; i++){
						var aa = res[j].SellList[i];
						var id = aa.ID;
						var name = aa.Name;
						var px = aa.PX;
						var buy = aa.Buy;
						var sell = aa.Sell;
						var je = buy - sell;
						var yzp = "";
						var youZiIcon = aa.YouZiIcon;
						if(youZiIcon == 1){
							yzp = "一线游资";
						}else if(youZiIcon == 2){
							yzp = "顶级游资";					
						}else if(youZiIcon == 3){
							yzp = "知名游资";					
						}
						if(yzp != ""){
							yzp = "<span id='tag1'>" + yzp + "</span>";
						}
						
						var yzmc = "";
						var groupicon = aa.GroupIcon[0];
						if(groupicon != undefined){
							yzmc = "<span id='tag1'>" + groupicon + "</span>";
						}
						
						var gl = "";
						var associcon = aa.AssocIcon;
						if(associcon == 1){
							gl = "<span id='tag1'>关联</span>";
						}
						
						var zb = "";
						var zs = "";
						if(ytdbusin != ""){
							var ystb = ytdbusin.buy;
							if(ystb != undefined){
								var aa = ystb[id];
								if(aa != undefined){
									zb = "<span id='tag4'>昨买" + aa + "</span>";
								}
							}
							var ysts = ytdbusin.sell;
							if(ysts != undefined){
								var aa = ysts[id];
								if(aa != undefined){
									zs = "<span id='tag5'>昨卖" + aa + "</span>";
								}
							}
						}
						
						//买卖显示格式
						if(g == 0){
							newDiv2.innerHTML += "<p>" + px + "、" + name + "<span style='margin-left:10px;color:#FF80FF;'>买：" + 
							NumberTransform(buy) + "</span><span style='margin-left:5px;color:#00FF80;'>卖：" + NumberTransform(sell) + 
							"</span><span style='margin-left:5px;color:#fff;'>净额："+ NumberTransform(je) + "</span></p>";
						}else if(g == 1){
							newDiv2.innerHTML += "<p><span id=" + count + "a>" + px + "、" + name + "</span><span id=" + count + "b style='color:#FF80FF;'>买：" + 
							NumberTransform(buy) + "</span><span id=" + count + "c style='color:#00FF80;'>卖：" + NumberTransform(sell) + 
							"</span><span id=" + count + "d style='color:#fff;'>净额："+ NumberTransform(je) + "</span></p>";
							
							//计算字符长度
							var diva = document.getElementById(count + 'a');
							var dw = diva.offsetWidth;
							if(dw > w){
								w = dw;
							}
						}
						
						if(gl + yzp + yzmc + zb + zs != ""){
							newDiv2.innerHTML += "<p style='margin:-15px 0px 0px 15px;'>" + gl + yzp + yzmc + zb + zs + "</p>";
						}
						count++;
					}					
				}
				
				//设定买卖数据起始位置 
				if(g == 1){
					var n = 30;
					for (var i = 1; i < count; i++){
						var div1 = document.getElementById(i + 'b');
						div1.style.position= "absolute"; 
						div1.style.left= w + n + "px";
						
						var div2 = document.getElementById(i + 'c');
						div2.style.position= "absolute"; 
						div2.style.left= w + n + 80 + "px";
						
						var div3 = document.getElementById(i + 'd');
						div3.style.position= "absolute"; 
						div3.style.left= w + n + 160 + "px";
					}
					newDiv.style.width= w + n + 260 + "px";
				}
				
				div.scrollTop = 0; //回到顶部
			}
			
			function changeCss1(obj){				
				var alist = document.getElementById("content").getElementsByTagName("a");					
				for(var i = 0; i < alist.length; i++){				
					if(alist[i].id != "xq" && alist[i].id.indexOf("px") == -1){
						alist[i].style.color = "#F9F9F9"; //给所有a标签赋原色
					}
				}
				obj.style.color = "#00FFFF"; //令当前标签高亮				
			}
			
			var gl = "净额";  //高亮
			function tables(data,id) {
				if(data.length > 0){	
					var json = data;
					
					//创建table					
					var table=document.createElement("table");										
					var thead=document.createElement("thead");
					table.appendChild(thead);					
					var tr=document.createElement("tr");
					thead.appendChild(tr);					
					
					var m = 0;
					var n = 0;
					var q = 0;
					var rq = tt;					
					for(var key in json[0]){  //表头
						key = key.replace('Sto','代码').replace('StoN','名称').replace('Money','净额');
						var th=document.createElement("th");						
						th.innerHTML=key;						
						tr.appendChild(th);
						if(gl == key.replace("%","")){
							n = m;
							if(ids != "yzgp" && ids != "yybgp"){
								th.style.color = "#FFFF80";	
							}
						}
						if(key == "日期"){
							q = m;
						}
						m++;
					}

					var tbody=document.createElement("tbody");					
					table.appendChild(tbody);
					
					//遍历json
					for(var i = 0; i < json.length; i++){					
						var tr=document.createElement("tr");						
						var p = 1;
						var dm = "";
						var mc = "";
						for(var key in json[i]){ //行元素遍历						
							var td=document.createElement("td");							
							
							var rc = json[i][key];
							if(p == 1){  //代码列
								dm = rc;
								tr.id = i + "#" + id + "#" + dm;
							}else if(p == 2){
								mc = rc;
							}else if(p == n + 1){
								rc = NumberTransform(rc);
							}
							
							if(p > 1 && p == q + 1){
								rq = rc;
							}
							
							var href = "http://www.treeid/code_" + dm;							
							if(tdx == 0){
								href = "javascript:void(0);";	
							}
							td.innerHTML = "<a href=" + href + " id='" + p + "' onclick='lhb(\"" + dm + "\",\"日期\");changeCss(\"" + tr.id + "\",\"" + ids + "\")'>" + rc + "</a>";
							//td.innerHTML = "<a href=http://www.treeid/code_" + dm + " id='" + p + "' onclick='lhb(\"" + dm + "\",\"日期\");changeCss(\"" + tr.id + "\",\"" + ids + "\")'>" + rc + "</a>";
							
							if(id == "营业部"){
								td.innerHTML = "<a href='javascript:void(0);' id='" + p + "' onclick='yybgp(\"" + mc + "\"," + dm + ");getHQ();changeCss(\"" + tr.id + "\",\"" + ids + "\")'>" + rc + "</a>";								
							}
							
							if(p == n + 1 && ids != "yzgp" && ids != "yybgp"){														
								var value = parseFloat(JSON.stringify(rc).replace('万','').replace('亿','').replace(/"/,''));							
								if(value >= 0){
									td.getElementsByTagName("a")[0].style.color = "#FF6633";
								}else{
									td.getElementsByTagName("a")[0].style.color = "#00FF00";
								}							
							}
							
							tr.appendChild(td);													
							p++;
						}
						tr.innerHTML = tr.innerHTML.replace(/日期/g,rq);
						tbody.appendChild(tr);																
					}
					
					var div1 = document.getElementById(id);												
					div1.appendChild(table);
					table.id = "table" + id;	
					if(fs > 1){
						changeTable(table,"0")
					}
				}						
			}
			
			//添加列
			function AddTableCell(table,p){					
				var trs = table.rows;
				var columns = table.rows[0].cells;
				var rowLength = trs.length;  //行數量
				var c = 0;				
				if(columns.length >= p + 1){
					for(var i = 0; i < rowLength; i++){						
						if(trs[i].cells[p].innerText == "当日涨幅"){
							c = 1;
						}						
					}
				}
				
				var d = 0;
				for(var i = 0; i < columns.length; i++){						
					if(trs[0].cells[i].innerText == "日期"){
						d = i;
					}						
				}
				
				var e = 0;				 
				for(var i = 0; i < rowLength; i++){					
					var NewCell = trs[i].cells[p];
					if(c == 0){
						NewCell = trs[i].insertCell(p);
					}					
					if(i == 0){
						if(c == 0){
							NewCell.innerHTML = "当日涨幅";	
							NewCell.style.color = "#E8E800";
						}
					}else{
						NewCell.innerHTML = "";
						if(e == 0){ 
							var code = trs[i].cells[0].innerText;							
							var rq = tt;
							if(d > 0){
								var rq = trs[i].cells[d].innerText;
							}
						
							if(rq.replace(/-/g,"") >= st.replace(/-/g,"")){
								var drzf = 0;
								var a = zfs.findIndex((v) => {    
									return v.code ===  code;
								});
								if(a > -1){
									var arrfind = zfs.find(function (item) {
										return item.code == code
									});
									drzf = arrfind.zf; 						
								}
								NewCell.innerHTML = drzf;
								if(drzf >= 0){
									NewCell.style.color = "#FF0080";
								}else{
									NewCell.style.color = "#80FF80";
								}
							}else{
								e = 1;
							}
						}
					}					
				}				
			}	
			
			function getHQ(){
				if(fs == 1){
					getzf(dma);
					var div = document.getElementById('游资动向');
					for(var i = 0; i < yn; i++){
						var table = div.getElementsByTagName("table")[i];
						AddTableCell(table,4);						
					}
					
					getzf(dmb);
					var div = document.getElementById('yzgp');
					var table = div.getElementsByTagName("table")[0];
					AddTableCell(table,6);
				}else if(fs == 2){
					getzf(dma);
					var div = document.getElementById('机构');
					var table = div.getElementsByTagName("table")[0];
					AddTableCell(table,7);
				}else if(fs == 3){				
					getzf(dma);
					var div = document.getElementById('股票');
					var table = div.getElementsByTagName("table")[0];
					AddTableCell(table,3);
				}else if(fs == 4){
					getzf(dmb);
					var div = document.getElementById('yybgp');
					var table = div.getElementsByTagName("table")[0];
					AddTableCell(table,6);			
				}
			
			}
			
			//隐藏某列				
            function changeTable(table,ss) {	
				var trs = table.rows;
				ss = ss + '#';
				var aa = ss.split('#');
				for (var j = 0; j < aa.length; j++) {
					if(aa[j] != ""){
						for (var i = 0, len = trs.length; i < len; i++) {					
							var p = aa[j];
							var cell = trs[i].cells[p]; 
							cell.style.display = 'none';
						}
					}
				}					
			}
			
			function makeSortable(table,p,id) {
				var headers=table.getElementsByTagName("th");
				for(var i=0;i<headers.length;i++){				
					(function(n){
						var flag=false;
							
						headers[n].onclick=function(){							
							showCol(n,p,id)
							var tbody=table.tBodies[0];
							var rows=tbody.getElementsByTagName("tr");
							rows=Array.prototype.slice.call(rows,0);

							//基于第n个<td>元素的值对行排序
							rows.sort(function(row1,row2){
								headtxt = headers[n].textContent;
								var cell1=row1.getElementsByTagName("td")[n];//获得第n个单元格
								var cell2=row2.getElementsByTagName("td")[n];																
								var val1=cell1.textContent||cell1.innerText;//获得文本内容
								var val2=cell2.textContent||cell2.innerText;
								if(headtxt == "名称" || headtxt == "日期" || headtxt == "类别" || headtxt.indexOf("游资") > -1){
									val1 = val1;
									val2 = val2;
								}else if(headtxt == "连板"){
									if(val1 == ""){
										val1 = 0;
									}else{
										val1 = parseInt(val1);
									}
									
									if(val2 == ""){
										val2 = 0;
									}else{
										val2 = parseInt(val2);
									}
								}else{
									
									if(val1.indexOf("万") != -1){
										val1 = parseFloat(val1)*10000;
									}else if(val1.indexOf("亿") != -1){
										val1 = parseFloat(val1)*100000000;
									}else{
										val1 = parseFloat(val1);
									}
									
									if(val2.indexOf("万") != -1){
										val2 = parseFloat(val2)*10000;
									}else if(val2.indexOf("亿") != -1){
										val2 = parseFloat(val2)*100000000;
									}else{
										val2 = parseFloat(val2);
									}
								}
								if(val1<val2){
									return -1;
								}else if(val1>val2){
									return 1;
								}else{
									return 0;
								}
							});
							if(flag){
								rows.reverse();
							}
							
							for(var i=0;i<rows.length;i++){
								tbody.appendChild(rows[i]);
							}

							flag=!flag;
						}
					}(i));
				}
			}
			
			function showCol(iCol,p,id){
				var div = document.getElementById(id);
				var oTable = div.getElementsByTagName('table')[p];
				
				//表头
				var th = oTable.getElementsByTagName("th");						
				for (var i=0;i < th.length; i++){	    //列遍历
					th[i].style.color = "#E5E5E5";      //还原										
					th[iCol].style.color = "#FFFF80";	//选中				
				}
				
				var tr = oTable.getElementsByTagName("tr");	
				for (var i=1;i < tr.length; i++){	//行遍历
					var otagsA = tr[i].getElementsByTagName("a");
					for (var j=0;j < otagsA.length; j++){	//列遍历						
						otagsA[j].style.color = "#E5E5E5";	//还原	
					}
					var value = otagsA[iCol].innerText.replace(/(万)|(亿)|(%)/g,'');
					value = value.replace("买入","1").replace("卖出","-1");
					if(!isNaN(parseFloat(value)) && isFinite(value)){  //判断列是否为数字
						if(parseFloat(value) >= 0){
							otagsA[iCol].style.color = "#FF6633";     //正负颜色
						}else{
							otagsA[iCol].style.color = "#00FF00";
						}
					}else{
						otagsA[iCol].style.color = "#FF6633";
					}					
				}					
			}	
			
			var trid = "";
			function changeCss(hid,id){
				var tlist = document.getElementById(id).getElementsByTagName("tr");					
				for(var i = 0; i < tlist.length; i++){														
					tlist[i].style.backgroundColor = bkcolor;			
				}
				trid = hid;
				var tr = document.getElementById(hid);				
				tr.style.backgroundColor = "#483D8B";						
			}
			
			function hover(){ 
				var rows = document.getElementsByTagName('tr');
				for(var i=0;i<rows.length;i++){
					rows[i].onmouseover=function(){						
						if(this.id != ""){  //过滤表头
							this.style.background="#800000";
						}
					}
					rows[i].onmouseout=function(){
						if(this.id != ""){  //过滤表头														
							this.style.background = bkcolor;
							if(this.id == trid){									
								this.style.background="#483D8B";
							}							
						}
					}					
				}
			}
			
		</script>		
	</body>
</html>